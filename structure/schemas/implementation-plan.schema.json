{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://forge-sdd-toolkit.dev/schemas/implementation-plan.schema.json",
  "title": "Implementation Plan",
  "description": "Schema for validating Implementation Plans generated by forge-plan",
  "type": "object",
  "required": [
    "metadata",
    "executiveSummary",
    "epics",
    "stories",
    "phases",
    "effortEstimation"
  ],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["project", "created", "author", "basedOn", "status"],
      "properties": {
        "project": {
          "type": "string"
        },
        "created": {
          "type": "string",
          "format": "date"
        },
        "author": {
          "type": "string"
        },
        "basedOn": {
          "type": "object",
          "required": ["specification", "architecture"],
          "properties": {
            "specification": {
              "type": "string",
              "pattern": "^specification-.+\\.md$"
            },
            "architecture": {
              "type": "string",
              "pattern": "^ADD-.+\\.md$"
            }
          }
        },
        "status": {
          "type": "string",
          "enum": ["Draft", "Under Review", "Approved", "In Progress", "Complete"]
        }
      }
    },
    "executiveSummary": {
      "type": "object",
      "required": ["goal", "totalEffort", "timeline", "team", "milestones"],
      "properties": {
        "goal": {
          "type": "string"
        },
        "totalEffort": {
          "type": "object",
          "required": ["storyPoints", "hours"],
          "properties": {
            "storyPoints": {
              "type": "number",
              "minimum": 0
            },
            "hours": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "timeline": {
          "type": "object",
          "required": ["start", "end", "weeks"],
          "properties": {
            "start": {
              "type": "string",
              "format": "date"
            },
            "end": {
              "type": "string",
              "format": "date"
            },
            "weeks": {
              "type": "number",
              "minimum": 1
            }
          }
        },
        "team": {
          "type": "object",
          "required": ["developers"],
          "properties": {
            "developers": {
              "type": "number",
              "minimum": 1
            }
          }
        },
        "milestones": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["name", "date"],
            "properties": {
              "name": {
                "type": "string"
              },
              "date": {
                "type": "string",
                "format": "date"
              }
            }
          }
        }
      }
    },
    "epics": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "name", "goal", "userValue", "estimatedEffort", "stories"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^EPIC-\\d+$",
            "description": "Epic ID (e.g., EPIC-1)"
          },
          "name": {
            "type": "string"
          },
          "goal": {
            "type": "string"
          },
          "userValue": {
            "type": "string"
          },
          "tracesTo": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^REQ-(F|NFR)-\\d{3}$"
            }
          },
          "estimatedEffort": {
            "type": "object",
            "required": ["hours"],
            "properties": {
              "hours": {
                "type": "number",
                "minimum": 0
              }
            }
          },
          "stories": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "pattern": "^STORY-\\d+\\.\\d+$"
            },
            "description": "Story IDs in this epic"
          }
        }
      }
    },
    "stories": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "id",
          "asA",
          "iWant",
          "soThat",
          "acceptanceCriteria",
          "estimatedEffort",
          "priority",
          "tasks"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^STORY-\\d+\\.\\d+$"
          },
          "title": {
            "type": "string"
          },
          "asA": {
            "type": "string"
          },
          "iWant": {
            "type": "string"
          },
          "soThat": {
            "type": "string"
          },
          "acceptanceCriteria": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["id", "description"],
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^AC-\\d+\\.\\d+\\.\\d+$"
                },
                "description": {
                  "type": "string"
                }
              }
            }
          },
          "estimatedEffort": {
            "type": "object",
            "required": ["hours"],
            "properties": {
              "hours": {
                "type": "number",
                "minimum": 0
              }
            }
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2"]
          },
          "dependencies": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^STORY-\\d+\\.\\d+$"
            }
          },
          "tracesTo": {
            "type": "object",
            "properties": {
              "requirements": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^REQ-(F|NFR)-\\d{3}$"
                }
              },
              "architectureDecisions": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^ADD-[A-Z]+-\\d{3}$"
                }
              }
            }
          },
          "tasks": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "pattern": "^TASK-\\d+\\.\\d+\\.\\d+$"
            }
          }
        }
      }
    },
    "tasks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "id",
          "title",
          "description",
          "deliverable",
          "estimatedTime",
          "storyId"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^TASK-\\d+\\.\\d+\\.\\d+$",
            "description": "Task ID (e.g., TASK-1.1.1)"
          },
          "title": {
            "type": "string",
            "minLength": 5,
            "maxLength": 100
          },
          "description": {
            "type": "string",
            "minLength": 10
          },
          "technicalDetails": {
            "type": "string",
            "description": "Code snippets, algorithms, APIs to use"
          },
          "deliverable": {
            "type": "string",
            "description": "Specific output - file, function, component"
          },
          "estimatedTime": {
            "type": "object",
            "required": ["hours"],
            "properties": {
              "hours": {
                  "type": "number",
                  "minimum": 2,
                  "maximum": 8,
                  "description": "Task should be 2-8 hours"
                },
                "complexity": {
                  "type": "string",
                  "enum": ["Simple", "Medium", "Large"]
                }
              }
          },
          "assignedTo": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["Todo", "In Progress", "Done", "Blocked"]
          },
          "storyId": {
            "type": "string",
            "pattern": "^STORY-\\d+\\.\\d+$"
          },
          "tracesTo": {
            "type": "object",
            "properties": {
              "requirement": {
                "type": "string",
                "pattern": "^REQ-(F|NFR)-\\d{3}$"
              },
              "architectureDecision": {
                "type": "string",
                "pattern": "^ADD-[A-Z]+-\\d{3}$"
              },
              "acceptanceCriterion": {
                "type": "string",
                "pattern": "^AC-\\d+\\.\\d+\\.\\d+$"
              }
            }
          }
        }
      }
    },
    "phases": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["number", "name", "goal", "stories", "deliverables", "successCriteria"],
        "properties": {
          "number": {
            "type": "number",
            "minimum": 1
          },
          "name": {
            "type": "string"
          },
          "timeline": {
            "type": "string",
            "description": "e.g., 'Week 1' or 'Weeks 2-3'"
          },
          "goal": {
            "type": "string"
          },
          "stories": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^STORY-\\d+\\.\\d+$"
            }
          },
          "deliverables": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["description", "completed"],
              "properties": {
                "description": {
                  "type": "string"
                },
                "completed": {
                  "type": "boolean"
                }
              }
            }
          },
          "successCriteria": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["criterion", "met"],
              "properties": {
                "criterion": {
                  "type": "string"
                },
                "met": {
                  "type": "boolean"
                }
              }
            }
          }
        }
      }
    },
    "effortEstimation": {
      "type": "object",
      "required": ["summaryByEpic", "total", "buffer"],
      "properties": {
        "summaryByEpic": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["epicId", "stories", "tasks", "hours", "percentOfTotal"],
            "properties": {
              "epicId": {
                "type": "string",
                "pattern": "^EPIC-\\d+$"
              },
              "stories": {
                "type": "number",
                "minimum": 0
              },
              "tasks": {
                "type": "number",
                "minimum": 0
              },
              "hours": {
                "type": "number",
                "minimum": 0
              },
              "percentOfTotal": {
                "type": "string",
                "pattern": "^\\d+%$"
              }
            }
          }
        },
        "total": {
          "type": "object",
          "required": ["stories", "tasks", "hours"],
          "properties": {
            "stories": {
              "type": "number",
              "minimum": 0
            },
            "tasks": {
              "type": "number",
              "minimum": 0
            },
            "hours": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "buffer": {
          "type": "object",
          "required": ["contingency", "totalWithBuffer"],
          "properties": {
            "contingency": {
              "type": "object",
              "required": ["percent", "hours"],
              "properties": {
                "percent": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100
                },
                "hours": {
                  "type": "number",
                  "minimum": 0
                }
              }
            },
            "totalWithBuffer": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "methodology": {
          "type": "object",
          "properties": {
            "taskSizing": {
              "type": "object",
              "properties": {
                "small": {
                  "type": "string"
                },
                "medium": {
                  "type": "string"
                },
                "large": {
                  "type": "string"
                }
              }
            },
            "confidenceLevels": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "string",
                    "enum": ["High", "Medium", "Low"]
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "risks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "description", "likelihood", "impact", "mitigation"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^RISK-\\d+$"
          },
          "description": {
            "type": "string"
          },
          "likelihood": {
            "type": "string",
            "enum": ["High", "Medium", "Low"]
          },
          "impact": {
            "type": "string",
            "enum": ["High", "Medium", "Low"]
          },
          "mitigation": {
            "type": "object",
            "required": ["actions"],
            "properties": {
              "actions": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string"
                }
              },
              "tasksAffected": {
                "type": "array",
                "items": {
                  "type": "string",
                  "pattern": "^TASK-\\d+\\.\\d+\\.\\d+$"
                }
              }
            }
          }
        }
      }
    },
    "qualityGates": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "name", "criteria", "approver"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^GATE-\\d+$"
          },
          "name": {
            "type": "string"
          },
          "criteria": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["criterion", "met"],
              "properties": {
                "criterion": {
                  "type": "string"
                },
                "met": {
                  "type": "boolean"
                }
              }
            }
          },
          "approver": {
            "type": "string"
          },
          "approved": {
            "type": "boolean"
          }
        }
      }
    },
    "definitionOfDone": {
      "type": "object",
      "required": ["forTasks", "forStories", "forEpics"],
      "properties": {
        "forTasks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["criterion", "description"],
            "properties": {
              "criterion": {
                "type": "string"
              },
              "description": {
                "type": "string"
              }
            }
          }
        },
        "forStories": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["criterion", "description"],
            "properties": {
              "criterion": {
                "type": "string"
              },
              "description": {
                "type": "string"
              }
            }
          }
        },
        "forEpics": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["criterion", "description"],
            "properties": {
              "criterion": {
                "type": "string"
              },
              "description": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  }
}
